<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Popularity and Prize Money of E-sports</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
</head>
<body>
	<h1>Total World Tournament Prize Money for E-Sports</h1>
	<h3>Derrick Lin (drl222), Eric Lin (esl89), Timothy Abbott (tra32)</h3>
	<div id="main">
	</div>

	<script>

	var maxPrize = 20000000;
	var maxPrize2 = 2500000;

	var nonVideoGames = ["Snooker", "Poker World Series"];
	var canvasX = 1000;
	var canvasY = 500;
	var bottomMargin = 50;
	var leftMargin = 70;
	var topMargin = 50;
	var rightMargin = 200;

	var svg = d3.select("#main").append("svg")
		.attr("id", "main_svg")
		.attr("height", canvasY)
		.attr("width", canvasX);

	d3.select("#main").append("br");

	var svg2 = d3.select("#main").append("svg")
		.attr("id", "main_svg")
		.attr("height", canvasY)
		.attr("width", canvasX);

	var g = svg.append("g");

	//year
	var xScale = d3.scale.linear().domain([1997.5, 2014.5]).range([leftMargin, canvasX - rightMargin]);
	//prize money
	//var yScale = d3.scale.log().domain([100, maxPrize]).range([canvasY - bottomMargin, topMargin]);
	var yScale = d3.scale.linear().domain([0, maxPrize]).range([canvasY - bottomMargin, topMargin]);

	var yScale2 = d3.scale.linear().domain([0, maxPrize2]).range([canvasY - bottomMargin, topMargin]);

	var gamesData;
	d3.json("gamesData.json", function(error, data){
		gamesData = data;

		var line = d3.svg.line()
		.x(function(game){ return xScale(Number(game["Year"])) })
		.y(function(game){ return yScale(Number(game["Prize"])) });

		var line2 = d3.svg.line()
		.x(function(game){ return xScale(Number(game["Year"])) })
		.y(function(game){ return yScale2(Number(game["Prize"])) });

		var colAngle = 0;
		var angleIncrement = 360 / (gamesData.length - nonVideoGames.length);
		gamesData.forEach(function(game){
			var newPath = svg.append("path").attr("d", line(game.Data)).style("fill", "none");

			var newPath2 = svg2.append("path").attr("d", line2(game.Data)).style("fill", "none");
			if(nonVideoGames.indexOf(game.Game) !== -1) {
				newPath.style("stroke", "#000000").style("stroke-width", "5");
				newPath2.style("stroke", "#000000").style("stroke-width", "5");
			} else {
				if(game.Data.length > 3){
					//filter out data without many points
					newPath.style("stroke", d3.hsl(colAngle, 1, 0.45));
					newPath2.style("stroke", d3.hsl(colAngle, 1, 0.45));
				}
				colAngle += angleIncrement;
			}

			//find 2014 data points
			var needsLabel = false;
			var last_entry;
			game.Data.forEach(function(entry){
				if(entry.Year == "2014"){
					needsLabel = true;
					last_entry = entry;
				}
			});

			//append label
			if(needsLabel){
				svg.append("text").text(game.Game)
				.attr("transform", "translate(" + (canvasX-rightMargin) + "," + yScale(Number(last_entry.Prize)) + ")")
				.attr("dy", "5px");

				svg2.append("text").text(game.Game)
				.attr("transform", "translate(" + (canvasX-rightMargin) + "," + yScale2(Number(last_entry.Prize)) + ")")
				.attr("dy", "5px");
			}

		});
		
		var xAxis = d3.svg.axis().scale(xScale).orient("bottom").tickFormat(d3.format(""));
		//axes: graph 1
		var yAxis = d3.svg.axis().scale(yScale).orient("left").tickFormat(function(d) {return d3.format(".1f")(d/1000000);});
		svg.append("g").attr("class", "axis").attr("transform", "translate(0, " + (canvasY - bottomMargin) + ")").call(xAxis);
		svg.append("g").attr("class", "axis").attr("transform", "translate(" + (leftMargin) + ", 0)").call(yAxis);
		//Title and axis labels
		svg.append("text").attr("x", canvasX/2).attr("y", canvasY-15)
			.attr("font-size", "15").attr("text-anchor", "middle").text("Year");
		svg.append("text").attr("x", "20").attr("y", canvasY/2)
			.attr("font-size", "15").attr("text-anchor", "middle").attr("transform", "rotate(-90, 20, "+ canvasY/2 +")")
			.text("Prize Money (millions of dollars)");


		//axes: graph 2
		var yAxis2 = d3.svg.axis().scale(yScale2).orient("left").tickFormat(function(d) {return d3.format(".1f")(d/1000000);});
		svg2.append("g").attr("class", "axis").attr("transform", "translate(0, " + (canvasY - bottomMargin) + ")").call(xAxis);
		svg2.append("g").attr("class", "axis").attr("transform", "translate(" + (leftMargin) + ", 0)").call(yAxis2);
		//Title and axis labels
		svg2.append("text").attr("x", canvasX/2).attr("y", canvasY-15)
			.attr("font-size", "15").attr("text-anchor", "middle").text("Year");
		svg2.append("text").attr("x", "20").attr("y", canvasY/2)
			.attr("font-size", "15").attr("text-anchor", "middle").attr("transform", "rotate(-90, 20, "+ canvasY/2 +")")
			.text("Prize Money (millions of dollars)");
	});
	</script>
</body>
</html>